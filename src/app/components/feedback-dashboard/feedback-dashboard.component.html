<div class="feedback-dashboard">
  <!-- Header with stats and controls -->
  <div class="dashboard-header">
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-value">{{ stats().total }}</span>
        <span class="stat-label">{{ i18n.t.grumble.total }}</span>
      </div>
      <div class="stat positive">
        <span class="stat-value">{{ stats().positive }}</span>
        <span class="stat-label">ğŸ˜Š {{ i18n.t.grumble.positive }}</span>
      </div>
      <div class="stat neutral">
        <span class="stat-value">{{ stats().neutral }}</span>
        <span class="stat-label">ğŸ˜ {{ i18n.t.grumble.neutral }}</span>
      </div>
      <div class="stat negative">
        <span class="stat-value">{{ stats().negative }}</span>
        <span class="stat-label">ğŸ˜¤ {{ i18n.t.grumble.negative }}</span>
      </div>
    </div>

    <div class="controls">
      <!-- Source type filters -->
      <div class="source-filters">
        @for (source of sourceFilters(); track source.type) {
        <button class="filter-btn" [class.active]="source.enabled" (click)="toggleSourceType(source.type)">
          {{ source.label }}
        </button>
        }
      </div>

      <!-- Sentiment filter -->
      <div class="sentiment-filters">
        <button class="sentiment-btn" [class.active]="selectedSentiment() === null" (click)="setSentimentFilter(null)">
          {{ i18n.t.grumble.all }}
        </button>
        <button class="sentiment-btn positive" [class.active]="selectedSentiment() === 'positive'"
          (click)="setSentimentFilter('positive')">
          ğŸ˜Š
        </button>
        <button class="sentiment-btn neutral" [class.active]="selectedSentiment() === 'neutral'"
          (click)="setSentimentFilter('neutral')">
          ğŸ˜
        </button>
        <button class="sentiment-btn negative" [class.active]="selectedSentiment() === 'negative'"
          (click)="setSentimentFilter('negative')">
          ğŸ˜¤
        </button>
      </div>

      <!-- Actions -->
      <div class="actions">
        @if (selectedCount() > 0) {
        <button class="action-btn analyze" (click)="analyzeSelected()" [disabled]="isAnalyzing()">
          {{ isAnalyzing() ? 'â³ ' + i18n.t.grumble.analyzing : 'ğŸ§  ' + i18n.t.grumble.analyze + ' (' + selectedCount() + ')' }}
        </button>
        <!-- Admin Only: Delete Selected -->
        @if (isAdmin) {
        <button class="action-btn delete" (click)="deleteSelectedFromCache()" [disabled]="isDeleting()">
          {{ isDeleting() ? 'â³ ' + i18n.t.grumble.deleting : 'ğŸ—‘ï¸ ' + i18n.t.grumble.delete + ' (' + selectedCount() + ')' }}
        </button>
        }
        }
        
        <!-- Admin Only: Clear All Cache -->
        @if (isAdmin) {
        <button class="action-btn clear-cache" (click)="clearAllCache()" [disabled]="isDeleting()">
          {{ isDeleting() ? 'â³ ' + i18n.t.grumble.deleting : 'ğŸ§¹ ' + i18n.t.grumble.clearCache }}
        </button>
        }
      </div>
    </div>
  </div>

  <!-- Sync Status Modal -->
  @if (feedbackService.syncStatus()) {
  <div class="sync-status-modal">
    <div class="sync-status-content">
      <div class="sync-spinner"></div>
      <div class="sync-message">{{ feedbackService.syncStatus()?.message }}</div>
    </div>
  </div>
  }

  <!-- Loading state -->
  @if (isLoading()) {
  <div class="loading-container">
    @for (i of [1,2,3,4,5]; track i) {
    <app-skeleton-item />
    }
  </div>
  }

  <!-- Empty state -->
  @if (!isLoading() && items().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">ğŸ”</div>
    <h3>{{ i18n.t.grumble.noFeedbackYet }}</h3>
    <p>{{ i18n.t.grumble.clickSyncToFetch }}</p>
  </div>
  }

  <!-- Feedback list -->
  @if (!isLoading() && items().length > 0) {
  <div class="results-header">
    <h2 class="results-title">ğŸ“‹ {{ i18n.t.grumble.feedbackResults }}</h2>
    <span class="results-count">{{ items().length }} {{ i18n.t.grumble.items }}</span>
  </div>
  <div class="feedback-list" [class.cards]="viewMode() === 'cards'">
    @for (item of items(); track item.id) {
    <div class="feedback-item" [class.selected]="item.selected" [class.analyzed]="item.analyzed"
      (click)="toggleItem(item)">

      <!-- Source badge with link -->
      <div class="item-source">
        <span class="source-icon">{{ getSourceIcon(item.sourceType) }}</span>
        <span class="source-name">{{ item.sourceName }}</span>
        <a class="source-link" [href]="item.url" target="_blank" (click)="$event.stopPropagation()"
          title="Open original">
          ğŸ”—
        </a>
        <span class="item-time">{{ formatDate(item.publishedAt) }}</span>
      </div>

      <!-- Title (if exists) -->
      @if (item.title || item.translatedTitles) {
      <div class="item-title">
        @if (getTranslatedTitle(item)) {
        <span class="translated-prefix">({{ i18n.t.grumble.translatedFrom }} {{ getLanguageName(item.language) }})</span>
        {{ getTranslatedTitle(item) }}
        } @else {
        {{ item.title }}
        }
      </div>
      }

      <!-- Content -->
      <div class="item-content">
        @if (getTranslatedContent(item)) {
        <span class="translated-prefix">({{ i18n.t.grumble.translatedFrom }} {{ getLanguageName(item.language) }})</span>
        {{ truncateContent(getTranslatedContent(item)!, 300) }}
        } @else {
        {{ truncateContent(item.content, 300) }}
        }
      </div>

      <!-- Author -->
      <div class="item-author">
        @if (item.authorAvatar) {
        <img class="author-avatar" [src]="item.authorAvatar" alt="">
        }
        <span class="author-name">{{ item.author }}</span>
        @if (item.authorHandle) {
        <span class="author-handle">@{{ item.authorHandle }}</span>
        }
      </div>

      <!-- Badges (sentiment + category) -->
      <div class="item-badges">
        @if (item.sentiment) {
        <span class="badge sentiment" [class]="getSentimentClass(item.sentiment)">
          {{ getSentimentIcon(item.sentiment) }}
        </span>
        }
        @if (item.category) {
        <span class="badge category">
          {{ getCategoryLabel(item.category).icon }} {{ getCategoryLabel(item.category).label }}
        </span>
        }
        @if (item.replyCount && item.replyCount > 0) {
        <span class="badge meta">ğŸ’¬ {{ item.replyCount }}</span>
        }
        @if (item.reactionCount && item.reactionCount > 0) {
        <span class="badge meta">â¤ï¸ {{ item.reactionCount }}</span>
        }
      </div>

      <!-- Actions -->
      <div class="item-actions">
        <button class="mini-btn" (click)="openUrl(item.url, $event)" title="Open">
          ğŸ”—
        </button>
        <button class="mini-btn" (click)="dismissItem(item, $event)" title="Dismiss">
          âœ•
        </button>
      </div>

      <!-- Selection indicator -->
      <div class="selection-indicator">
        {{ item.selected ? 'âœ“' : '' }}
      </div>
    </div>
    }
  </div>
  }
</div>
<!-- Confirmation Modal -->
@if (showConfirmModal()) {
<div class="modal-overlay" (click)="cancelConfirm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-message">{{ confirmMessage() }}</div>
    <div class="modal-actions">
      <button class="modal-btn cancel" (click)="cancelConfirm()">{{ i18n.t.common.cancel }}</button>
      <button class="modal-btn confirm" (click)="doConfirm()">OK</button>
    </div>
  </div>
</div>
}